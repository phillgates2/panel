name: Installer E2E (destructive, manual)

on:
  workflow_dispatch: {}

jobs:
  e2e:
    name: E2E on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    timeout-minutes: 90
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]

    steps:
      - uses: actions/checkout@v4

      - name: Print environment info
        run: |
          python - <<'PY'
          from tools.installer.deps import get_package_manager
          from tools.installer.os_utils import detect_elevation_methods
          import platform
          print('OS:', platform.system())
          print('Detected package manager:', get_package_manager())
          print('Detected elevation methods:', detect_elevation_methods())
          PY

      - name: Run Linux E2E
        if: runner.os == 'Linux'
        run: |
          chmod +x tools/installer/e2e/linux_e2e.sh
          sudo tools/installer/e2e/linux_e2e.sh

      - name: Run macOS E2E
        if: runner.os == 'macOS'
        run: |
          chmod +x tools/installer/e2e/macos_e2e.sh
          tools/installer/e2e/macos_e2e.sh

      - name: Run Windows E2E
        if: runner.os == 'Windows'
        shell: pwsh
        run: |
          Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process
          tools/installer/e2e/windows_e2e.ps1
