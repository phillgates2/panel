apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: panel

resources:
  - deployment.yaml
  - service.yaml
  - configmap.yaml
  - secrets.yaml
  - ingress.yaml
  - hpa.yaml
  - worker-deployment.yaml
  - network-policy.yaml
  - pvc.yaml
  - migration-job.yaml

images:
  - name: panel
    newTag: latest

commonLabels:
  app: panel
  environment: production

configMapGenerator:
  - name: panel-config
    literals:
      - DEPLOYMENT_ENV=kubernetes
      - KUBERNETES_SERVICE_HOST=""
      - KUBERNETES_SERVICE_PORT=""

secretGenerator:
  - name: panel-secrets
    literals:
      - database-url=postgres://user:pass@postgres:5432/panel
      - redis-url=redis://redis:6379
    options:
      disableNameSuffixHash: true

patchesStrategicMerge:
  - patches/env-patches.yaml

patchesJson6902:
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: panel-app
    path: patches/deployment-patches.yaml