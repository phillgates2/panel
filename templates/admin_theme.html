{% extends 'base.html' %}
{% block content %}
<h2>Theme Editor</h2>
<p>Edit the custom CSS below. Changes are applied immediately to the site once saved.</p>
<form method="post" enctype="multipart/form-data">
  <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
  <div style="margin-bottom:8px;">
    <label>
      <input type="checkbox" name="enabled" value="1" {% if theme_enabled %}checked{% endif %} /> Enable custom theme
    </label>
  </div>
  <div>
    <textarea name="css" rows="20" style="width:100%; font-family:monospace;">{{ css }}</textarea>
  </div>
  <div style="margin-top:8px;">
    <button type="submit">Save Theme</button>
  </div>
  <hr />
  <h3>Server Logos</h3>
  <p>Upload server logos here. They will be stored and served at <code>/theme_asset/&lt;filename&gt;</code>.</p>
  <div>
    <input type="file" name="logo" accept="image/*" />
    <button type="submit" formaction="{{ url_for('admin_theme') }}?upload=1">Upload Logo</button>
  </div>
  {% if assets %}
  <h4>Existing Logos</h4>
  <form method="post" style="margin-bottom:8px;">
    <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
    <button formaction="{{ url_for('admin_theme') }}?bulk_delete=1" formmethod="post">Delete Selected</button>
    <ul style="list-style:none; padding:0;">
    {% for a in assets %}
      <li style="display:flex; align-items:center; margin:6px 0;">
        <input type="checkbox" name="asset_ids" value="{{ a.id }}" />
        <div style="width:48px; height:48px; margin-left:8px;">
          <img src="{{ url_for('theme_asset_thumb', asset_id=a.id) }}" style="max-width:48px; max-height:48px;" alt="{{ a.filename }}" />
        </div>
        <div style="margin-left:8px; flex:1;">
          <a href="{{ url_for('theme_asset_by_id', asset_id=a.id) }}" target="_blank">{{ a.filename }}</a>
          <div style="font-size:0.9rem; color:#666;">Uploaded: {{ a.created_at }}</div>
        </div>
        <div>
          <form method="post" style="display:inline;">
            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
            <input type="hidden" name="delete_asset_id" value="{{ a.id }}" />
            <button type="submit">Delete</button>
          </form>
        </div>
      </li>
    {% endfor %}
    </ul>
  </form>
  {% endif %}
</form>
{% endblock %}
