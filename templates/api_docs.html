{% extends 'base.html' %}
{% block content %}
<div class="api-docs-page">
    <div class="page-header">
        <div class="welcome-section">
            <h1>ðŸ“š API Documentation</h1>
            <p class="text-secondary">Complete reference for the Panel REST API</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <div class="card">
                <div class="card-header">
                    <h5>Navigation</h5>
                </div>
                <div class="card-body">
                    <nav class="api-nav">
                        <a href="#overview" class="nav-link">Overview</a>
                        <a href="#authentication" class="nav-link">Authentication</a>
                        <a href="#servers" class="nav-link">Servers</a>
                        <a href="#commands" class="nav-link">Commands</a>
                        <a href="#webhooks" class="nav-link">Webhooks</a>
                        <a href="#errors" class="nav-link">Error Codes</a>
                    </nav>
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <div class="card" id="overview">
                <div class="card-header">
                    <h5><i class="fas fa-info-circle"></i> API Overview</h5>
                </div>
                <div class="card-body">
                    <p>The Panel API provides programmatic access to server management features including:</p>
                    <ul>
                        <li>Server status and information</li>
                        <li>RCON command execution</li>
                        <li>Player management</li>
                        <li>Real-time metrics</li>
                        <li>Webhook integrations</li>
                    </ul>

                    <h6>Base URL</h6>
                    <code>{{ request.host_url }}api/v1/</code>

                    <h6>Response Format</h6>
                    <p>All responses are in JSON format with appropriate HTTP status codes.</p>
                </div>
            </div>

            <div class="card mt-3" id="authentication">
                <div class="card-header">
                    <h5><i class="fas fa-lock"></i> Authentication</h5>
                </div>
                <div class="card-body">
                    <p>The API uses Bearer token authentication. Include your token in the Authorization header:</p>

                    <pre><code>Authorization: Bearer YOUR_API_TOKEN</code></pre>

                    <h6>Getting an API Token</h6>
                    <ol>
                        <li>Log in to the panel</li>
                        <li>Go to API Tokens page</li>
                        <li>Generate a new token</li>
                        <li>Use the token in your API requests</li>
                    </ol>

                    <div class="alert alert-warning">
                        <strong>Security Note:</strong> Keep your API tokens secure. They provide full access to your servers.
                    </div>
                </div>
            </div>

            <div class="card mt-3" id="servers">
                <div class="card-header">
                    <h5><i class="fas fa-server"></i> Server Endpoints</h5>
                </div>
                <div class="card-body">
                    <h6>GET /api/v1/servers</h6>
                    <p>Get list of servers you have access to.</p>
                    <pre><code>curl -H "Authorization: Bearer TOKEN" {{ request.host_url }}api/v1/servers</code></pre>

                    <h6>Response</h6>
                    <pre><code>{
  "servers": [
    {
      "id": 1,
      "name": "My Server",
      "host": "127.0.0.1",
      "port": 27960,
      "status": "online",
      "player_count": 5,
      "max_players": 32
    }
  ],
  "total": 1,
  "api_version": "v1"
}</code></pre>

                    <h6>GET /api/v1/servers/{id}</h6>
                    <p>Get detailed information about a specific server.</p>
                    <pre><code>curl -H "Authorization: Bearer TOKEN" {{ request.host_url }}api/v1/servers/1</code></pre>
                </div>
            </div>

            <div class="card mt-3" id="commands">
                <div class="card-header">
                    <h5><i class="fas fa-terminal"></i> Command Endpoints</h5>
                </div>
                <div class="card-body">
                    <h6>POST /api/v1/servers/{id}/command</h6>
                    <p>Send an RCON command to a server.</p>
                    <pre><code>curl -X POST -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"command": "status"}' \
  {{ request.host_url }}api/v1/servers/1/command</code></pre>

                    <h6>Request Body</h6>
                    <pre><code>{
  "command": "status"
}</code></pre>

                    <h6>Response</h6>
                    <pre><code>{
  "success": true,
  "command": "status",
  "response": "map: oasis\nplayers: 5\n...",
  "timestamp": "2025-11-20T10:30:00Z"
}</code></pre>
                </div>
            </div>

            <div class="card mt-3" id="webhooks">
                <div class="card-header">
                    <h5><i class="fas fa-webhook"></i> Webhooks</h5>
                </div>
                <div class="card-body">
                    <p>Webhooks allow external services to receive real-time notifications about server events.</p>

                    <h6>POST /api/v1/webhooks</h6>
                    <p>Receive webhook notifications (typically called by external services).</p>

                    <h6>Supported Events</h6>
                    <ul>
                        <li><code>server_status</code> - Server online/offline status changes</li>
                        <li><code>player_event</code> - Player join/leave events</li>
                    </ul>

                    <h6>Example Payload</h6>
                    <pre><code>{
  "type": "player_event",
  "server_id": 1,
  "player_name": "Player123",
  "event": "join",
  "timestamp": "2025-11-20T10:30:00Z"
}</code></pre>
                </div>
            </div>

            <div class="card mt-3" id="errors">
                <div class="card-header">
                    <h5><i class="fas fa-exclamation-triangle"></i> Error Codes</h5>
                </div>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Status Code</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>200</td>
                                <td>Success</td>
                            </tr>
                            <tr>
                                <td>400</td>
                                <td>Bad Request - Invalid input</td>
                            </tr>
                            <tr>
                                <td>401</td>
                                <td>Unauthorized - Invalid or missing token</td>
                            </tr>
                            <tr>
                                <td>403</td>
                                <td>Forbidden - Access denied</td>
                            </tr>
                            <tr>
                                <td>404</td>
                                <td>Not Found - Resource doesn't exist</td>
                            </tr>
                            <tr>
                                <td>500</td>
                                <td>Internal Server Error</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.api-docs-page {
    padding: 20px 0;
}

.api-nav .nav-link {
    display: block;
    padding: 8px 0;
    color: var(--text);
    text-decoration: none;
    border-bottom: 1px solid var(--border);
}

.api-nav .nav-link:hover {
    color: var(--primary);
}

.card {
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.card-header {
    background: var(--panel);
    border-bottom: 1px solid var(--border);
    border-radius: 10px 10px 0 0 !important;
}

code {
    background: var(--panel);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.9em;
}

pre {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 15px;
    overflow-x: auto;
}

pre code {
    background: none;
    padding: 0;
}
</style>

<script>
// Smooth scrolling for navigation
document.querySelectorAll('.api-nav a').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
</script>
{% endblock %}