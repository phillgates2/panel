# Panel Log Rotation Configuration
# Place in /etc/logrotate.d/panel

/opt/panel/logs/*.log /opt/panel/*.log {
    # Rotate daily
    daily
    
    # Keep 30 days of logs
    rotate 30
    
    # Compress old logs
    compress
    delaycompress
    
    # Don't error if log file is missing
    missingok
    
    # Don't rotate empty logs
    notifempty
    
    # Create new log with these permissions
    create 0640 panel panel
    
    # Use date extension instead of numbers
    dateext
    dateformat -%Y%m%d
    
    # Shared scripts for all logs
    sharedscripts
    
    # Reload application after rotation
    postrotate
        # Reload Panel if running
        if systemctl is-active panel.service > /dev/null 2>&1; then
            systemctl reload panel.service > /dev/null 2>&1 || true
        fi
        
        # Alternative: Send signal to reload logs
        # kill -USR1 $(cat /opt/panel/panel.pid) 2>/dev/null || true
    endscript
}

# Celery logs (if using Celery)
/opt/panel/logs/celery*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0640 panel panel
    dateext
    
    postrotate
        if systemctl is-active panel-celery.service > /dev/null 2>&1; then
            systemctl reload panel-celery.service > /dev/null 2>&1 || true
        fi
    endscript
}

# Nginx access logs for Panel
/var/log/nginx/panel-access.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data adm
    dateext
    
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 $(cat /var/run/nginx.pid)
        fi
    endscript
}

# Nginx error logs for Panel
/var/log/nginx/panel-error.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data adm
    dateext
    
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 $(cat /var/run/nginx.pid)
        fi
    endscript
}
