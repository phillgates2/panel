# Multi-Region PostgreSQL Setup
# This requires PostgreSQL with streaming replication

# Primary (us-east-1)
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres-primary
  namespace: panel-us-east
spec:
  serviceName: postgres-primary
  replicas: 1
  template:
    spec:
      containers:
      - name: postgres
        image: postgres:13
        env:
        - name: POSTGRES_DB
          value: paneldb
        - name: POSTGRES_USER
          value: paneluser
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: postgres-secret
              key: password
        - name: POSTGRES_REPLICATION_MODE
          value: "master"
        ports:
        - containerPort: 5432

# Replica (us-west-2)
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres-replica
  namespace: panel-us-west
spec:
  serviceName: postgres-replica
  replicas: 1
  template:
    spec:
      containers:
      - name: postgres
        image: postgres:13
        env:
        - name: POSTGRES_DB
          value: paneldb
        - name: POSTGRES_USER
          value: paneluser
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: postgres-secret
              key: password
        - name: POSTGRES_REPLICATION_MODE
          value: "slave"
        - name: POSTGRES_MASTER_HOST
          value: "postgres-primary.panel-us-east.svc.cluster.local"
        ports:
        - containerPort: 5432