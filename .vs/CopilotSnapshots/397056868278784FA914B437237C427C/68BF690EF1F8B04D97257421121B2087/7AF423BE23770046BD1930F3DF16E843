# Interactive API Documentation

This guide explains the interactive API documentation setup using Flask-RESTX for the Panel application.

## Overview

The Panel application includes comprehensive interactive API documentation with:

- **Swagger UI**: Interactive API explorer with live testing
- **ReDoc**: Clean, responsive documentation viewer
- **OpenAPI Specification**: Machine-readable API specification
- **Authentication Integration**: Token-based API testing
- **Schema Validation**: Request/response validation
- **Code Examples**: Multiple language examples

## Prerequisites

1. **Flask-RESTX**:
   ```bash
   pip install flask-restx
   ```

2. **API Endpoints**: RESTful API endpoints to document

3. **Authentication System**: Token-based authentication for API access

## API Structure

### Namespaces

The API is organized into logical namespaces:

- **auth**: Authentication operations
- **users**: User management
- **forum**: Forum operations
- **admin**: Administrative functions
- **gdpr**: GDPR compliance
- **health**: System health checks

### Data Models

API responses use consistent data models:

```python
user_model = api.model('User', {
    'id': fields.Integer(readonly=True, description='User ID'),
    'email': fields.String(required=True, description='Email address'),
    'first_name': fields.String(required=True, description='First name'),
    'last_name': fields.String(required=True, description='Last name'),
    'role': fields.String(description='User role'),
    'is_active': fields.Boolean(description='Account status')
})
```

## Interactive Documentation

### Accessing Documentation

```bash
# Swagger UI
http://localhost:8080/api/v1/docs

# ReDoc
# Available through the documentation page tabs

# OpenAPI JSON
http://localhost:8080/api/v1/swagger.json
```

### Features

#### Swagger UI Features
- **Try It Out**: Execute API calls directly from the browser
- **Authentication**: Automatic token inclusion in requests
- **Request Builder**: Interactive parameter input
- **Response Viewer**: Formatted response display
- **Schema Explorer**: Detailed model definitions

#### ReDoc Features
- **Three-Panel Layout**: Request, Response, and Model views
- **Search**: Full-text search across documentation
- **Responsive**: Mobile-friendly design
- **Print-Friendly**: Clean printing layout

## Authentication Integration

### Token Management

The documentation includes client-side token management:

```javascript
// Save API token
localStorage.setItem('api_token', token);

// Include in requests
requestInterceptor: function(req) {
    const token = localStorage.getItem('api_token');
    if (token) {
        req.headers.Authorization = 'Bearer ' + token;
    }
    return req;
}
```

### Testing Authenticated Endpoints

1. **Login**: Use the auth/login endpoint to get a token
2. **Save Token**: Enter token in the documentation interface
3. **Test Endpoints**: All subsequent requests include the token

## API Endpoint Documentation

### Authentication Endpoints

```python
@auth_ns.route('/login')
class Login(Resource):
    @auth_ns.expect(login_model)
    @auth_ns.response(200, 'Success', user_model)
    @auth_ns.response(401, 'Invalid credentials')
    def post(self):
        """Authenticate user"""
        # Implementation
```

### Response Documentation

All endpoints include detailed response documentation:

- **Success Responses**: Expected data structure
- **Error Responses**: Error codes and messages
- **Status Codes**: HTTP status code meanings
- **Content Types**: Supported request/response formats

## Code Examples

### Python Example

```python
import requests

# Login
response = requests.post('http://localhost:8080/api/v1/auth/login', json={
    'email': 'user@example.com',
    'password': 'password123'
})
token = response.json()['token']

# Use token for authenticated requests
headers = {'Authorization': f'Bearer {token}'}
response = requests.get('http://localhost:8080/api/v1/users/', headers=headers)
```

### JavaScript Example

```javascript
// Login
const loginResponse = await fetch('/api/v1/auth/login', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        email: 'user@example.com',
        password: 'password123'
    })
});
const { token } = await loginResponse.json();

// Use token
const response = await fetch('/api/v1/users/', {
    headers: {'Authorization': `Bearer ${token}`}
});
const users = await response.json();
```

### cURL Example

```bash
# Login
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"password123"}'

# Use token
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8080/api/v1/users/
```

## Customization

### API Metadata

```python
api = Api(
    app,
    version='1.0',
    title='Panel API',
    description='Professional game server management API',
    contact='Panel Team',
    contact_email='api@panel.local'
)
```

### Custom Styling

The documentation includes custom CSS for consistent branding:

```css
.swagger-ui .topbar { display: none; }
.swagger-ui .info .title { color: #1f6feb; }
```

### Error Handling

Consistent error responses across all endpoints:

```python
@api.errorhandler(BadRequest)
def handle_bad_request(error):
    return {'message': 'Bad request', 'error': str(error)}, 400
```

## Integration with Development

### Auto-Generation

API documentation is automatically generated from:

- **Route Decorators**: HTTP methods and paths
- **Docstrings**: Endpoint descriptions
- **Model Definitions**: Request/response schemas
- **Status Codes**: Response documentation

### Validation

Request/response validation ensures:

- **Type Safety**: Data type validation
- **Required Fields**: Mandatory parameter checking
- **Format Validation**: Email, URL, and custom formats
- **Schema Compliance**: JSON schema validation

## Deployment Considerations

### Production Setup

1. **API Versioning**: Include version in URL paths
2. **Rate Limiting**: Implement request throttling
3. **CORS**: Configure cross-origin policies
4. **SSL/TLS**: Use HTTPS for all API calls

### Documentation Hosting

```nginx
# Serve API docs
location /api/docs {
    proxy_pass http://api-server;
    proxy_set_header Host $host;
}

# Serve OpenAPI spec
location /api/v1/swagger.json {
    proxy_pass http://api-server;
    add_header Cache-Control "public, max-age=3600";
}
```

## Testing Integration

### Automated Testing

The API documentation integrates with testing:

```bash
# Generate test cases from OpenAPI spec
openapi-generator-cli generate -i swagger.json -g python -o tests/

# Validate API compliance
swagger-cli validate swagger.json
```

### Contract Testing

```python
# Test API contracts
import pytest
from schemathesis import given
from schemathesis.models import Case

@given(case=Case.from_schema("swagger.json"))
def test_api_contract(case):
    response = case.call()
    case.validate_response(response)
```

## Best Practices

### Documentation Standards

1. **Clear Descriptions**: Use descriptive endpoint names
2. **Consistent Naming**: Follow RESTful conventions
3. **Version Control**: Include API versioning
4. **Deprecation Notices**: Mark deprecated endpoints
5. **Change Logs**: Document API changes

### Security Considerations

1. **Token Handling**: Never expose tokens in documentation
2. **Rate Limiting**: Implement request throttling
3. **Input Validation**: Validate all inputs
4. **Error Messages**: Avoid exposing sensitive information

### Performance

1. **Caching**: Cache documentation responses
2. **Compression**: Enable gzip compression
3. **CDN**: Use CDN for documentation assets
4. **Lazy Loading**: Load documentation components on demand

## Troubleshooting

### Common Issues

1. **Documentation Not Loading**:
   ```bash
   # Check Flask-RESTX installation
   pip list | grep flask-restx

   # Verify blueprint registration
   # Check app.py for api_bp registration
   ```

2. **Authentication Not Working**:
   ```javascript
   // Clear stored tokens
   localStorage.removeItem('api_token');

   // Check token format
   console.log(localStorage.getItem('api_token'));
   ```

3. **Schema Validation Errors**:
   ```python
   # Check model definitions
   # Verify field types and requirements
   # Test with sample data
   ```

### Debug Tools

```python
# Enable debug mode
app.config['DEBUG'] = True
app.config['TESTING'] = True

# Log API requests
@app.before_request
def log_request_info():
    app.logger.debug(f'API Request: {request.method} {request.url}')
```

This interactive API documentation provides developers with a comprehensive, user-friendly interface for exploring and testing the Panel API, improving developer experience and API adoption.
